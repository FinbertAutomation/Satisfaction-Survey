<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>סקר שביעות רצון</title>
    <link rel="icon" type="image/x-icon"
        href="https://drive.google.com/uc?export=view&id=1trh0BYIOMdh3Cc2kEM9HnIz2NWwpSZOD&export=download&format=png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <style>
        .centered-box {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .custom-border {
            border: 2px solid green;
            padding: 20px;
            max-width: 600px;

        }

        .form-check-label {
            text-align: right;
        }

        .form-check-label,
        .form-check-input {
            display: inline-block;
        }

        .form-check .form-check-input {
            float: left;
            margin-left: 11rem;
        }

        #thankYouDiv {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100vh;
        }
    </style>


</head>

<body>

    <body>
        <div id="thankYouDiv" class="d-none">
            <h3 style=" direction: rtl;">תודה שמילאת את השאלון!</h3>
            <!-- Add any additional content or styling you want for the thank you message here --  -->
        </div>

        <div class="centered-box" id="questionnaireDiv" style="direction: rtl; margin-top: 31rem;">
            <!--  -->
            <div class="custom-border mt-3">
                <img src="https://drive.google.com/uc?export=view&id=1UoU1GQKDs96TLWTkc4hTQYKN1euOvK4q" alt="Logo"
                    style="max-width: 100%; height: auto;">
                <h2 style="text-align: center;">סקר שביעות רצון לקוח - פינברט סוכנות לביטוח (2021) בע"מ</h2>
                <p>
                    <span id="person-id">שלום רב,</span><br>
                    חשוב לנו לשמוע אותך ולבדוק שהשירות שקיבלת מאיתנו עמד בציפיות שלך (ואם לא אז לדעת מה לשפר).<br>
                    נודה לך אם תוכל להקדיש מספר דקות למילוי השאלון.
                    <br>
                    בברכה, מחלקת ניהול קשרי לקוחות פינברט.
                </p>
                <hr>

                <div id="question1-div-id">
                    <h6>האם קיבלת מידע מקצועי ומענה ממוקד לתיק הפנסיוני שלך?</h6>
                    <p>במידה רבה מאוד: 5</p>
                    <p>כלל לא: 1</p>
                    <div class="form-check">
                        <label class="form-check-label me-4" for="option1">1 😞</label>
                        <input class="form-check-input" type="radio" name="question1" id="option1" value="1">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label me-4" for="option2">2</label>
                        <input class="form-check-input" type="radio" name="question1" id="option2" value="2">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label  me-4" for="option3">3 😐</label>
                        <input class="form-check-input" type="radio" name="question1" id="option3" value="3">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label  me-4" for="option4">4</label>
                        <input class="form-check-input" type="radio" name="question1" id="option4" value="4">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label  me-4" for="option5">5 😃</label>
                        <input class="form-check-input" type="radio" name="question1" id="option5" value="5">
                    </div>
                </div>

                <hr>
                <div id="question2-div-id">
                    <h6>האם השירות שקיבלת מהסוכן ענה על הציפיות שלך?</h6>
                    <p>במידה רבה מאוד: 5</p>
                    <p>כלל לא: 1</p>
                    <div class="form-check">
                        <label class="form-check-label  me-4" for="option6">1 😞</label>
                        <input class="form-check-input" type="radio" name="question2" id="option6" value="1">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label  me-4" for="option7">2</label>
                        <input class="form-check-input" type="radio" name="question2" id="option7" value="2">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label me-4" for="option8">3 😐</label>
                        <input class="form-check-input" type="radio" name="question2" id="option8" value="3">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label me-4" for="option9">4</label>
                        <input class="form-check-input" type="radio" name="question2" id="option9" value="4">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label me-4" for="option10">5 😃</label>
                        <input class="form-check-input" type="radio" name="question2" id="option10" value="5">
                    </div>
                </div>
                <hr>


                <div id="question3-div-id">
                    <h6>עד כמה הסוכן השפיע על בחירתך להצטרף לפינברט ?</h6>
                    <p>במידה רבה מאוד: 5</p>
                    <p>כלל לא: 1</p>
                    <div class="form-check">
                        <label class="form-check-label me-4" for="option11">1 😞</label>
                        <input class="form-check-input" type="radio" name="question3" id="option11" value="1">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label me-4" for="option12">2</label>
                        <input class="form-check-input" type="radio" name="question3" id="option12" value="2">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label me-4" for="option13">3 😐</label>
                        <input class="form-check-input" type="radio" name="question3" id="option13" value="3">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label me-4" for="option14">4</label>
                        <input class="form-check-input" type="radio" name="question3" id="option14" value="4">
                    </div>
                    <div class="form-check">
                        <label class="form-check-label me-4" for="option15">5 😃</label>
                        <input class="form-check-input" type="radio" name="question3" id="option15" value="5">
                    </div>
                </div>


                <hr>
                <div id="question5-div-id">
                    <h6>האם בעקבות הפגישה תמליץ/צי למכריך על שירות בדיקת תיק פנסיוני ע"י פינברט סוכנות לביטוח (2021)
                        בע"מ?</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="question5" id="option16" value="כן">
                        <label class="form-check-label" for="option16">כן 👍</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="question5" id="option17" value="לא">
                        <label class="form-check-label" for="option17">לא 👎</label>
                    </div>
                </div>

                <hr>
                <div>
                    <h6>לצורך שיפור השירות נשמח לשמוע הערות נוספות</h6>
                    <textarea class="form-control" name="question4_comments" rows="4" placeholder="הערותיך"
                        id="comments"></textarea>
                </div>

                <hr>
                <div class="d-grid">
                    <button class="btn btn-success d-grid mt-3" type="button" id="submitButton">שלח טופס</button>
                </div>

                <div id="liveAlertPlaceholder"></div>


                <hr>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous">
            </script>



        <script>

            var globalPerson;
            var globalMid;
 

            //-----------------------------------------------------------------
            function sendDataToServer() {
                var selectedAnswers = {};

                // Loop through radio button inputs
                var radioInputs = document.querySelectorAll('input[type="radio"]');
                radioInputs.forEach((input) => {
                    if (input.checked) {
                        var questionName = input.name;
                        var answer = input.value;
                        selectedAnswers[questionName] = answer;
                    }
                });

                // Get text from textarea
                const comments = document.getElementById('comments').value;
                selectedAnswers['question4_comments'] = comments;
                console.log('Selected Answers - line 245:', selectedAnswers);

                //Add parameters from URL and add to selectedAnswers       
                
                var urlParams = new URLSearchParams(window.location.search);
                var personName = urlParams.get('person');
                var midId = urlParams.get('mid');

                selectedAnswers[person] = personName;
                selectedAnswers[mid] = midId;

                console.log('Selected Answers - line 256:', selectedAnswers);

                selectedAnswers[person] = globalPerson;
                selectedAnswers[mid] = globalMid;

                console.log('Selected Answers - line 261:', selectedAnswers);


                //fetch with post

                //show thankYouDiv
                var thankYouDiv = document.getElementById('thankYouDiv');
                var questionnaireDiv = document.getElementById('questionnaireDiv'); // Give your questionnaire div an ID

                if (thankYouDiv && questionnaireDiv) {
                    thankYouDiv.classList.remove('d-none');
                    questionnaireDiv.classList.add('d-none');
                }

                // Set the cookie with SameSite=None and Secure attributes      
                document.cookie = "myCookie=survey; Secure";


            }; //sendDataToServer


            //------------------------------Validation tests----------------------------------------
            var alertPlaceholder;
            var question1Inputs = Array.from(document.querySelectorAll('#question1-div-id input'));
            var question2Inputs = Array.from(document.querySelectorAll('#question2-div-id input'));
            var question3Inputs = Array.from(document.querySelectorAll('#question3-div-id input'));
            var question5Inputs = Array.from(document.querySelectorAll('#question5-div-id input'));

            let question1SomeTrue;
            let question2SomeTrue;
            let question3SomeTrue;
            let question5SomeTrue;

            function checkedQ1() {
                question1SomeTrue = question1Inputs.some(r => r.checked == true);
                console.log("question1SomeTrue: " + question1SomeTrue);

                if (!question1SomeTrue) {
                    question1Inputs.forEach(input => input.classList.add("is-invalid"));
                    alertPlaceholder = document.getElementById('liveAlertPlaceholder');
                    showCustomAlert('אנא ענה על השאלות המודגשות', 'danger');
                } else {
                    question1Inputs.forEach(input => input.classList.remove("is-invalid"));
                    checkedQ2();
                };//if else
            };//checkedQ1

            function checkedQ2() {
                question2SomeTrue = question2Inputs.some(r => r.checked == true);
                console.log("question2SomeTrue: " + question2SomeTrue);

                if (!question2SomeTrue) {
                    question2Inputs.forEach(input => input.classList.add("is-invalid"));
                    alertPlaceholder = document.getElementById('liveAlertPlaceholder');
                    showCustomAlert('אנא ענה על השאלות המודגשות', 'danger');
                } else {
                    question2Inputs.forEach(input => input.classList.remove("is-invalid"));
                    checkedQ3();
                };//if else
            };//checkedQ2

            function checkedQ3() {
                question3SomeTrue = question3Inputs.some(r => r.checked == true);
                console.log("question3SomeTrue: " + question3SomeTrue);

                if (!question3SomeTrue) {
                    question3Inputs.forEach(input => input.classList.add("is-invalid"));
                    alertPlaceholder = document.getElementById('liveAlertPlaceholder');
                    showCustomAlert('אנא ענה על השאלות המודגשות', 'danger');
                } else {
                    question3Inputs.forEach(input => input.classList.remove("is-invalid"))
                    checkedQ5();
                };
            };//checkedQ3

            function checkedQ5() {
                question5SomeTrue = question5Inputs.some(r => r.checked == true);
                console.log("question5SomeTrue: " + question5SomeTrue);

                if (!question5SomeTrue) {
                    question5Inputs.forEach(input => input.classList.add("is-invalid"));
                    alertPlaceholder = document.getElementById('liveAlertPlaceholder');
                    showCustomAlert('אנא ענה על השאלות המודגשות', 'danger');
                } else {
                    question5Inputs.forEach(input => input.classList.remove("is-invalid"));
                    sendDataToServer();
                };//if
            }
            //------------------------------------insertPersonName----------------------------------------------

            function insertPersonName() {
                // Get the URL of the parent window
                var urlParams = new URLSearchParams(window.location.search);
                var personName = urlParams.get('person');
                var midId = urlParams.get('mid');

                console.log("personName:" + personName);
                console.log("midId: " + midId);

                globalPerson = urlParams.get('person');
                globalMid = urlParams.get('mid');

                // If the 'person' parameter is present, inject it into the HTML
                if (personName) {
                    var personElement = document.getElementById('person-id');
                    if (personElement) {
                        let personWithGreeting = `${personName}, שלום רב, `;
                        personElement.textContent = personWithGreeting;
                    }
                }

            };//insertPersonName  
            //-------------------------------------------------------------------

            function showCustomAlert(message, type) {
                var wrapper = document.createElement('div')
                wrapper.innerHTML = '<div class="alert alert-' + type + ' alert-dismissible" role="alert">' + message + '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>'

                alertPlaceholder.append(wrapper)
            }
            //------------------------------------------------------------------------


            document.addEventListener('DOMContentLoaded', insertPersonName);
            document.getElementById("submitButton").addEventListener('click', checkedQ1);
            //----------------------------------------------------------------------

        </script>


    </body>

</html>
